# 해외주식 AD 매집/분산 전략 (Accumulation/Distribution Line)

## 전략 ID
`AD`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **"하루 중 가격이 어디서 마감했는지"를 거래량과 결합해서, 매수세가 강한지 매도세가 강한지를 알려주는 도구**입니다.

OBV와 비슷하지만 더 정교합니다. OBV는 "오늘 올랐냐 내렸냐"만 보지만, A/D는 **"고가와 저가 사이에서 종가가 어디에 있는가"**까지 고려합니다. 종가가 고가에 가까우면 매수세가 강했던 것이고, 저가에 가까우면 매도세가 강했던 것입니다.

## 📊 A/D Line 시각화

### 1. 기본 개념

A/D Line이 상승하면 **매집 진행 (롱 신호)**, 하락하면 **분산 진행 (숏 신호)**입니다.

![A/D 기본 개념](./images/ad_basic_concept.png)

### 2. 다이버전스 패턴

가격과 A/D가 다르게 움직일 때 추세 전환을 예고합니다.

![A/D 다이버전스](./images/ad_divergence.png)

## 이 전략이 필요한 이유

- 같은 "상승"이라도 **종가가 고가 근처에서 끝났는지, 저가 근처에서 끝났는지**에 따라 의미가 다릅니다.
- 고가 마감 = "매수세가 끝까지 유지됨" = 강한 상승
- 저가 마감 = "매도세가 우세해짐" = 약한 상승
- A/D Line은 이 차이를 거래량에 반영해서 **진짜 수급을 보여줍니다**.

## 전략 상세 설명

### 먼저, 용어를 간단히 정리해 볼게요

- **Money Flow Multiplier (MFM)**
    - "오늘 종가가 고가-저가 범위에서 어디에 있었는가"를 -1 ~ +1 사이 숫자로 나타냅니다.
    - 계산: [(종가 - 저가) - (고가 - 종가)] ÷ (고가 - 저가)
    - **+1**: 종가 = 고가 (완벽한 강세)
    - **-1**: 종가 = 저가 (완벽한 약세)
    - **0**: 종가 = (고가+저가)/2 (중립)

- **Money Flow Volume (MFV)**
    - MFM에 거래량을 곱한 값입니다.
    - "오늘의 거래량이 매수 쪽인지 매도 쪽인지"를 나타냅니다.

- **A/D Line (Accumulation/Distribution Line)**
    - MFV를 누적한 값입니다.
    - 상승하면 **매집(Accumulation)** = 매수세 우세
    - 하락하면 **분산(Distribution)** = 매도세 우세

- **다이버전스 (Divergence)**
    - 가격과 A/D Line이 다른 방향으로 움직일 때입니다.
    - **강세 다이버전스**: 가격 ↓ + A/D ↑ → 반등 가능성
    - **약세 다이버전스**: 가격 ↑ + A/D ↓ → 하락 가능성

### OBV vs A/D Line 비교

| 항목 | OBV | A/D Line |
| --- | --- | --- |
| 계산 방식 | 상승/하락 여부만 봄 | 종가 위치(고가/저가 대비)도 반영 |
| 정교함 | 단순 | 정교함 |
| 갭 반영 | 전체 거래량 | 가중치 적용 |
| 활용 | 대략적인 수급 파악 | 정밀한 수급 파악 |

### 어떤 방식으로 동작하나요?

1. **데이터 수집**
    - LS증권 OpenAPI에서 제공하는 OHLCV 데이터를 사용합니다.

2. **MFM 계산**
    - 각 캔들에서 종가가 고가/저가 범위 내 어디에 있는지 계산합니다.

3. **MFV 계산**
    - MFM × 거래량으로 "수급 흐름"을 계산합니다.

4. **A/D Line 계산**
    - MFV를 누적해서 A/D Line을 만듭니다.

5. **신호 판단**
    - A/D > A/D EMA: **매집 (accumulation)**
    - A/D < A/D EMA: **분산 (distribution)**
    - 가격과 A/D 방향 불일치: **다이버전스**

### 방향성은 이렇게 해석하세요

- **매수 고려**
    - A/D Line이 상승 중이면 "돈이 들어오고 있다"
    - 가격이 떨어지는데 A/D가 올라가면 (강세 다이버전스) → 반등 가능성!

- **매도 고려**
    - A/D Line이 하락 중이면 "돈이 빠지고 있다"
    - 가격이 오르는데 A/D가 떨어지면 (약세 다이버전스) → 하락 가능성!

- **돌파 확인**
    - 가격이 저항선을 돌파할 때 A/D도 신고점이면 → 진짜 돌파!
    - 가격만 돌파하고 A/D가 안 따라오면 → 가짜 돌파 가능성

### 활용 시나리오

- 상승 중인 종목의 **"상승이 진짜인지, 힘이 빠지고 있는지"** 판단하고 싶을 때
- OBV보다 **더 정교한 수급 분석**을 하고 싶을 때
- 가격 돌파 시 **"진성 돌파 vs 가짜 돌파"**를 구분하고 싶을 때

## DSL 예시

```python
{
    "condition_id": "AD",
    "params": {
        "appkey": "발급받은 LS증권 키",
        "appsecretkey": "발급받은 LS증권 시크릿",
        "ema_period": 20,
        "divergence_lookback": 20,
        "timeframe": "days",
        "qrycnt": 200
    }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `appkey` | str | - | LS증권에서 발급받은 Open API 키입니다. |
| `appsecretkey` | str | - | LS증권에서 발급받은 Open API 시크릿입니다. |
| `ema_period` | int | 20 | A/D Line의 EMA 계산 기간입니다. |
| `divergence_lookback` | int | 20 | 다이버전스를 감지할 과거 기간입니다. |
| `timeframe` | str | "days" | 캔들 주기입니다. `"days"`, `"weeks"`, `"months"` 중 선택 |
| `qrycnt` | int | 200 | 불러올 캔들 개수입니다. |

## 응답 데이터 설명

| 필드 | 설명 |
| --- | --- |
| `signal` | 현재 신호입니다. `"accumulation"` (매집), `"distribution"` (분산) |
| `ad_line` | 현재 A/D Line 값입니다. |
| `ad_ema` | A/D Line의 EMA 값입니다. |
| `ad_above_ema` | A/D가 EMA 위에 있는지 여부입니다. |
| `mfm` | 현재 Money Flow Multiplier 값입니다 (-1 ~ +1). |
| `divergence` | 다이버전스 상태입니다. `"bullish"`, `"bearish"`, `"none"` |
| `ad_trend` | A/D Line의 추세입니다. `"rising"`, `"falling"` |
| `price_trend` | 가격의 추세입니다. `"rising"`, `"falling"` |

## 신호 해석 가이드

| 상황 | 해석 | 대응 |
| --- | --- | --- |
| A/D > EMA | 매집 중 (매수세 우세) | 보유 또는 매수 고려 |
| A/D < EMA | 분산 중 (매도세 우세) | 청산 또는 관망 |
| 가격 ↑ + A/D ↑ | 건강한 상승 | 추세 따라가기 |
| 가격 ↓ + A/D ↓ | 건강한 하락 | 진입 자제 |
| **가격 ↓ + A/D ↑** | **강세 다이버전스!** | **반등 매수 준비** |
| **가격 ↑ + A/D ↓** | **약세 다이버전스!** | **하락 대비, 청산 고려** |

## A/D Line 활용 실전 예시

### 예시 1: MFM 해석
| 시나리오 | 고가 | 저가 | 종가 | MFM | 의미 |
| --- | --- | --- | --- | --- | --- |
| 강한 매수세 | $155 | $150 | $155 | +1.0 | 종가 = 고가, 완벽한 강세 |
| 약한 매수세 | $155 | $150 | $151 | -0.6 | 종가가 저가에 가까움, 약세 |
| 중립 | $155 | $150 | $152.5 | 0 | 종가 = 중간, 중립 |

### 예시 2: 약세 다이버전스
- AAPL 주가: $170 → $180 (신고가!)
- A/D Line: 이전 고점을 넘지 못함
- → **"가격은 신고가지만 수급은 약하다"**
- → **하락 가능성, 이익 실현 고려!**

### 예시 3: 돌파 확인
- 주가가 $150 저항선 돌파
- A/D Line도 함께 신고점 → **진짜 돌파!**
- A/D Line은 제자리 → **가짜 돌파 주의**

## 전략 사용 시 주의사항

- A/D Line은 **절대값보다 방향과 다이버전스가 중요**합니다.
- OBV와 마찬가지로 **주식에서 가장 잘 작동**합니다.
- 거래량이 매우 적거나 변동이 큰 종목에서는 신호가 불안정할 수 있습니다.
- **MFM이 0 근처에서 왔다갔다**하면 수급 판단이 어렵습니다. 이때는 다른 지표를 참고하세요.
- 다른 지표(가격 패턴, 이동평균, RSI 등)와 함께 사용하면 신뢰도가 높아집니다.
