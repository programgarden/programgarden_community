# 해외선물 볼린저 밴드 전략 (Bollinger Bands for Futures)

## 전략 ID
`FuturesBollingerBands`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **"선물 가격이 평균에서 얼마나 벗어나 있는지"를 자동으로 측정해, 롱(매수) 또는 숏(매도) 포지션을 추천하는 도구**입니다.

볼린저 밴드의 하단에 닿으면 **반등을 기대해 롱**, 상단에 닿으면 **조정을 기대해 숏** 포지션을 제안합니다. 또한 밴드폭이 좁아지면(스퀴즈) **곧 큰 움직임이 나올 것**을 알려줍니다.

## 📊 볼린저 밴드 시각화

### 1. 기본 구조

가격이 상단 밴드에 닿으면 **과매수 (숏 고려)**, 하단 밴드에 닿으면 **과매도 (롱 고려)**입니다.

![볼린저 밴드 기본](./images/bollinger_basic.png)

### 2. 스퀴즈 패턴

밴드폭이 좁아지면 곧 큰 움직임이 예상됩니다!

![볼린저 스퀴즈](./images/bollinger_squeeze.png)

## 이 전략이 필요한 이유

- 선물 거래에서는 **롱과 숏 양방향**으로 수익을 낼 수 있습니다.
- 하지만 "지금 롱을 잡아야 하나, 숏을 잡아야 하나?" 판단이 어렵습니다.
- 볼린저 밴드는 **가격이 극단적인 위치에 있을 때** 알려줘서, 반대 방향 진입 타이밍을 잡는 데 도움을 줍니다.

## 전략 상세 설명

### 먼저, 용어를 간단히 정리해 볼게요

- **이동평균선 (중심선, Middle Band)**
    - 최근 N일간의 종가 평균입니다.
    - 이 선이 **가격의 중심**이라고 생각하면 됩니다.

- **상단 밴드 (Upper Band)**
    - 중심선 + (표준편차 × 배수)입니다.
    - 가격이 여기까지 오면 **"평균보다 많이 높다"**는 뜻입니다.

- **하단 밴드 (Lower Band)**
    - 중심선 - (표준편차 × 배수)입니다.
    - 가격이 여기까지 내려오면 **"평균보다 많이 낮다"**는 뜻입니다.

- **밴드폭 (Bandwidth)**
    - 상단과 하단의 거리입니다.
    - 밴드폭이 좁으면 **변동성이 낮다 = 곧 큰 움직임이 나올 수 있다**고 해석합니다.

- **스퀴즈 (Squeeze)**
    - 밴드폭이 매우 좁아진 상태입니다.
    - **"에너지가 압축되어 폭발할 준비가 된 상태"**라고 보면 됩니다.

- **롱 (Long)**
    - 선물을 **매수**하는 것입니다.
    - 가격이 오르면 수익이 납니다.

- **숏 (Short)**
    - 선물을 **매도**하는 것입니다.
    - 가격이 내리면 수익이 납니다.

- **플랫 (Flat)**
    - 포지션이 없는 상태입니다.
    - 명확한 방향이 없을 때 관망합니다.

### 어떤 방식으로 포지션을 제안하나요?

| 상황 | 포지션 | 이유 |
| --- | --- | --- |
| **하단 밴드 터치** | `long` (롱) | 가격이 평균보다 많이 낮아서, 반등을 기대합니다 |
| **상단 밴드 터치** | `short` (숏) | 가격이 평균보다 많이 높아서, 조정을 기대합니다 |
| **스퀴즈 상태** | `flat` (관망) | 방향을 알 수 없으니 돌파 확인 후 진입합니다 |
| **중립 상태** | `flat` (관망) | 특별한 신호가 없습니다 |

### 활용 시나리오

- 해외선물(ES, NQ, CL, GC 등)에서 **단기 역추세 매매** 타이밍을 잡고 싶을 때
- 밴드가 좁아지는 종목에서 **큰 움직임을 대기**하고 있을 때
- 과매수/과매도 구간에서 **반대 포지션 진입**을 고려할 때

## DSL 예시

```python
{
    "condition_id": "FuturesBollingerBands",
    "params": {
        "appkey": "발급받은 LS증권 키",
        "appsecretkey": "발급받은 LS증권 시크릿",
        "period": 20,
        "std_dev": 2.0,
        "squeeze_threshold": 0.03,
        "timeframe": "days",
        "qrycnt": 200
    }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `appkey` | str | - | LS증권에서 발급받은 Open API 키입니다. |
| `appsecretkey` | str | - | LS증권에서 발급받은 Open API 시크릿입니다. |
| `period` | int | 20 | 이동평균 계산 기간입니다. 20일이 표준입니다. |
| `std_dev` | float | 2.0 | 표준편차 배수입니다. 2.0이 표준이며, 크게 하면 밴드가 넓어집니다. |
| `squeeze_threshold` | float | 0.03 | 밴드폭이 이 값 이하면 "스퀴즈 상태"로 판단합니다. |
| `timeframe` | str | "days" | 캔들 주기입니다. `"days"`, `"weeks"`, `"months"` 중 선택 |
| `qrycnt` | int | 200 | 불러올 캔들 개수입니다. |

## 응답 데이터 설명

| 필드 | 설명 |
| --- | --- |
| `position_side` | **추천 포지션**입니다. `"long"`, `"short"`, `"flat"`, `"neutral"` 중 하나 |
| `last_signal` | 감지된 신호입니다. `"lower_touch"`, `"upper_touch"`, `"squeeze"`, `"neutral"` |
| `current.middle` | 현재 중심선(이동평균) 값 |
| `current.upper` | 현재 상단 밴드 값 |
| `current.lower` | 현재 하단 밴드 값 |
| `current.bandwidth` | 현재 밴드폭 |
| `current.percent_b` | 현재 %B 값 (0~1 사이가 정상) |

## 포지션 신호 해석 가이드

| 신호 | position_side | 의미 | 대응 |
| --- | --- | --- | --- |
| `lower_touch` | `long` | 하단 밴드 터치 | 반등 기대, 롱 포지션 진입 고려 |
| `upper_touch` | `short` | 상단 밴드 터치 | 조정 기대, 숏 포지션 진입 고려 |
| `squeeze` | `flat` | 밴드폭 축소 | 방향 불명, 돌파 확인 후 진입 |
| `neutral` | `flat` | 특별한 신호 없음 | 관망 |

## 전략 사용 시 주의사항

- **역추세 매매 전략**이므로, 강한 추세에서는 밴드를 타고 계속 움직일 수 있습니다.
- 상단 터치 = 즉시 숏이 아닙니다. 강한 상승 추세에서는 밴드를 따라 계속 올라갈 수 있습니다.
- **스퀴즈 후 돌파 방향**에 따라 포지션을 잡는 것이 더 안전합니다.
- 선물은 레버리지가 있으므로 **손절 관리가 필수**입니다.
- 해외 데이터는 LS증권 OpenAPI에서 실시간으로 받아오므로, 호출 전 API 인증 상태를 반드시 확인하세요.
