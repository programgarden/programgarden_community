# 해외선물 KAMA 적응 이동평균 전략 (Kaufman's Adaptive Moving Average for Futures)

## 전략 ID
`FuturesKAMA`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **"시장 상황에 따라 스스로 속도를 조절하는 똑똑한 이동평균선"**을 기반으로, 롱(매수) 또는 숏(매도) 포지션을 추천하는 도구입니다.

가격이 KAMA 위에 있으면 **롱**, 아래에 있으면 **숏**을 제안합니다. 일반 이동평균과 달리, 추세가 강할 때는 빠르게 반응하고 횡보할 때는 느리게 움직여서 **거짓 신호를 줄여줍니다**.

## 📊 KAMA 시각화

### SMA vs KAMA 비교

KAMA는 추세장에서 빠르게 반응하고, 횡보장에서 거의 움직이지 않아 거짓 신호를 줄입니다.

![KAMA vs SMA](./images/kama_vs_sma.png)

## 이 전략이 필요한 이유

- 일반 이동평균(SMA, EMA)은 **횡보장에서 거짓 신호**가 많습니다.
- KAMA는 **"지금 추세가 강한가, 약한가"를 스스로 판단**해서 반응 속도를 조절합니다.
- 추세장에서는 빠르게 따라가고, 횡보장에서는 거의 안 움직여서 **불필요한 포지션 전환을 줄입니다**.

## 전략 상세 설명

### 먼저, 용어를 간단히 정리해 볼게요

- **KAMA (Kaufman's Adaptive Moving Average)**
    - 시장 상황에 따라 민감도가 자동으로 조절되는 이동평균입니다.
    - 추세가 강하면 빠르게 반응(EMA처럼), 횡보하면 느리게 반응(SMA처럼).

- **효율비 (Efficiency Ratio, ER)**
    - "가격이 얼마나 효율적으로 움직였는가"를 0~1 사이로 나타냅니다.
    - **ER ≈ 1**: 한 방향으로 꾸준히 움직임 (강한 추세)
    - **ER ≈ 0**: 왔다갔다 제자리 (횡보)

- **크로스오버 (Crossover)**
    - 가격이 KAMA를 돌파하는 순간입니다.
    - **골든 크로스**: 가격이 KAMA 위로 돌파 → 롱 신호
    - **데스 크로스**: 가격이 KAMA 아래로 돌파 → 숏 신호

### 어떤 방식으로 포지션을 제안하나요?

| 상황 | 포지션 | 이유 |
| --- | --- | --- |
| **가격 > KAMA** | `long` (롱) | 상승 추세, 가격이 평균 위에 있음 |
| **가격 < KAMA** | `short` (숏) | 하락 추세, 가격이 평균 아래에 있음 |
| **가격 ≈ KAMA** | `flat` (관망) | 방향 불명확, 돌파 확인 필요 |

### 효율비(ER)로 시장 상태 파악하기

| ER 값 | 시장 상태 | KAMA 특성 | 권장 |
| --- | --- | --- | --- |
| > 0.7 | 강한 추세 | 빠르게 반응 | 추세 추종 적극 |
| 0.3 ~ 0.7 | 보통 | 중간 민감도 | 신중한 진입 |
| < 0.3 | 횡보/노이즈 | 느리게 반응 | 거래 자제 |

### 활용 시나리오

- 해외선물에서 **추세 추종 매매**를 하고 싶은데, 횡보장에서 거짓 신호를 줄이고 싶을 때
- 이동평균 크로스오버 전략을 쓰는데 **더 정교한 신호**가 필요할 때
- 효율비를 통해 **"지금 진입해도 되는 시장인지"** 판단하고 싶을 때

## DSL 예시

```python
{
    "condition_id": "FuturesKAMA",
    "params": {
        "appkey": "발급받은 LS증권 키",
        "appsecretkey": "발급받은 LS증권 시크릿",
        "er_period": 10,
        "fast_period": 2,
        "slow_period": 30,
        "timeframe": "days",
        "qrycnt": 200
    }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `appkey` | str | - | LS증권에서 발급받은 Open API 키입니다. |
| `appsecretkey` | str | - | LS증권에서 발급받은 Open API 시크릿입니다. |
| `er_period` | int | 10 | 효율비(ER) 계산 기간입니다. |
| `fast_period` | int | 2 | 추세가 강할 때 적용할 빠른 EMA 기간입니다. |
| `slow_period` | int | 30 | 횡보할 때 적용할 느린 EMA 기간입니다. |
| `timeframe` | str | "days" | 캔들 주기입니다. `"days"`, `"weeks"`, `"months"` 중 선택 |
| `qrycnt` | int | 200 | 불러올 캔들 개수입니다. |

## 응답 데이터 설명

| 필드 | 설명 |
| --- | --- |
| `position_side` | **추천 포지션**입니다. `"long"`, `"short"`, `"flat"`, `"neutral"` 중 하나 |
| `trend` | 현재 추세입니다. `"bullish"` (상승), `"bearish"` (하락) |
| `efficiency_ratio` | 현재 효율비입니다. 1에 가까울수록 추세가 강합니다. |
| `current.kama` | 현재 KAMA 값입니다. |
| `current.smoothing_constant` | 현재 평활 상수입니다. |
| `current.crossover` | 크로스오버 발생 여부입니다. `"golden"`, `"death"`, `null` |

## 포지션 신호 해석 가이드

| 신호 | position_side | 의미 | 대응 |
| --- | --- | --- | --- |
| 가격 > KAMA, ER 높음 | `long` | 강한 상승 추세 | 롱 포지션 진입/유지 |
| 가격 < KAMA, ER 높음 | `short` | 강한 하락 추세 | 숏 포지션 진입/유지 |
| ER 낮음 | `flat` | 횡보장 | 거래 자제, 관망 |
| 골든 크로스 | `long` | 상승 전환 | 롱 진입 고려 |
| 데스 크로스 | `short` | 하락 전환 | 숏 진입 고려 |

## 전략 사용 시 주의사항

- 효율비(ER)가 낮을 때는 **신호가 지연**될 수 있습니다. 횡보장이니 거래를 자제하세요.
- 급격한 추세 전환 시 KAMA가 **늦게 반응**할 수 있습니다.
- `er_period`를 너무 짧게 설정하면 ER 계산이 불안정해집니다.
- **ER > 0.5일 때만** 포지션을 잡으면 거짓 신호를 줄일 수 있습니다.
- 선물은 레버리지가 있으므로 **손절 관리가 필수**입니다.
