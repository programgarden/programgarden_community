# 해외선물 OBV 거래량 전략 (On Balance Volume for Futures)

## 전략 ID
`FuturesOBV`

## 전략 기여자
ProgramGarden Team

## 간단한 설명

이 전략은 **"거래량이 어느 방향으로 흐르고 있는지"를 추적해서, 매수세가 우세한지 매도세가 우세한지 판단하는 도구**입니다.

OBV가 상승하면 **매수 압력 증가로 롱**, OBV가 하락하면 **매도 압력 증가로 숏**을 제안합니다. 특히 **가격과 OBV가 다르게 움직일 때(다이버전스)** 추세 전환을 미리 알려줍니다.

## 📊 OBV 시각화

### 1. 기본 개념

OBV가 상승하면 **매수 압력 증가**, 하락하면 **매도 압력 증가**입니다.

![OBV 기본](./images/obv_basic.png)

### 2. 다이버전스 패턴

가격과 OBV가 다르게 움직일 때 추세 전환을 예고합니다.

![OBV 다이버전스](./images/obv_divergence.png)

## 이 전략이 필요한 이유

- 가격만 보면 **추세가 진짜인지 가짜인지** 판단하기 어렵습니다.
- OBV는 **거래량으로 추세를 검증**해 줍니다.
- 가격보다 OBV가 **먼저 움직이는 경우**가 많아 선행 지표로 활용됩니다.

## 전략 상세 설명

### 먼저, 용어를 간단히 정리해 볼게요

- **OBV (On Balance Volume)**
    - 가격이 오르면 거래량을 **더하고**, 내리면 **빼서** 누적한 값입니다.
    - OBV 상승 = 매수세(사는 사람)가 더 많다
    - OBV 하락 = 매도세(파는 사람)가 더 많다

- **다이버전스 (Divergence)**
    - 가격과 지표가 **다른 방향**으로 움직이는 현상입니다.
    - **Bullish (강세)**: 가격은 내리는데 OBV는 올라감 → 곧 반등?
    - **Bearish (약세)**: 가격은 오르는데 OBV는 내려감 → 곧 하락?

- **선행 지표**
    - "먼저 움직이는" 지표라는 뜻입니다.
    - 가격이 움직이기 전에 거래량이 먼저 변할 수 있습니다.

### OBV 패턴 해석하기

| 가격 | OBV | 의미 |
| --- | --- | --- |
| **상승** | **상승** | 상승 추세 확인 (건강한 상승) |
| **하락** | **하락** | 하락 추세 확인 (건강한 하락) |
| **횡보** | **상승** | 매집 중! 곧 상승 돌파 가능 |
| **횡보** | **하락** | 분산 중! 곧 하락 돌파 가능 |
| **신고가** | **이전 고점 미달** | 약세 다이버전스 (하락 경고!) |
| **신저가** | **이전 저점 상승** | 강세 다이버전스 (상승 경고!) |

### 어떤 방식으로 포지션을 제안하나요?

| 상황 | 포지션 | 이유 |
| --- | --- | --- |
| **OBV > OBV 이동평균** | `long` (롱) | 매수 압력 우세 |
| **OBV < OBV 이동평균** | `short` (숏) | 매도 압력 우세 |
| **강세 다이버전스** | `long` (롱) | 반등 기대 |
| **약세 다이버전스** | `short` (숏) | 하락 기대 |

### 활용 시나리오

- 가격 돌파 시 **진짜 돌파인지 확인**하고 싶을 때
- **추세 전환을 미리 감지**하고 싶을 때
- 에너지/원자재 선물의 **수급 흐름**을 파악하고 싶을 때

## DSL 예시

```python
{
    "condition_id": "FuturesOBV",
    "params": {
        "appkey": "발급받은 LS증권 키",
        "appsecretkey": "발급받은 LS증권 시크릿",
        "ma_period": 20,
        "divergence_lookback": 10,
        "timeframe": "days",
        "qrycnt": 200
    }
}
```

## 파라미터 설명

| 이름 | 타입 | 기본값 | 설명 |
| --- | --- | --- | --- |
| `appkey` | str | - | LS증권에서 발급받은 Open API 키입니다. |
| `appsecretkey` | str | - | LS증권에서 발급받은 Open API 시크릿입니다. |
| `ma_period` | int | 20 | OBV 이동평균 기간입니다. |
| `divergence_lookback` | int | 10 | 다이버전스 확인 기간입니다. |
| `timeframe` | str | "days" | 캔들 주기입니다. |
| `qrycnt` | int | 200 | 불러올 캔들 개수입니다. |

## 응답 데이터 설명

| 필드 | 설명 |
| --- | --- |
| `position_side` | **추천 포지션**입니다. `"long"`, `"short"`, `"flat"`, `"neutral"` 중 하나 |
| `trend` | OBV 추세입니다. `"bullish"`, `"bearish"`, `"neutral"` |
| `divergence` | 다이버전스 유형입니다. `"bullish"`, `"bearish"`, `"none"` |
| `obv` | 현재 OBV 값입니다. |
| `obv_ma` | OBV 이동평균 값입니다. |

## 다이버전스 완전 정리

### 강세 다이버전스 (Bullish Divergence)
```
가격:  ＼      ＼   (저점 하락)
       ↘      ↘
OBV:   ＼    ／   (저점 상승)
       ↘    ↗
→ 매도 압력 감소, 곧 반등 가능!
```

### 약세 다이버전스 (Bearish Divergence)
```
가격:  ／    ／   (고점 상승)
       ↗    ↗
OBV:  ／   ＼    (고점 하락)
      ↗    ↘
→ 매수 압력 감소, 곧 하락 가능!
```

## 에너지 선물 심볼 예시

| 상품 | 심볼 | 설명 |
| --- | --- | --- |
| WTI 원유 | CL=F | 서부텍사스 원유 |
| 브렌트유 | BZ=F | 북해 원유 |
| 천연가스 | NG=F | 미국 천연가스 |
| 난방유 | HO=F | 히팅 오일 |
| 휘발유 | RB=F | RBOB 가솔린 |

## 전략 활용 팁

1. **추세 확인**: 가격이 오를 때 OBV도 같이 오르는지 확인 → 건강한 추세
2. **돌파 검증**: 저항선 돌파 시 OBV도 같이 돌파하는지 확인
3. **매집/분산 감지**: 가격이 횡보해도 OBV가 움직이면 추세 변화 임박
4. **선행 신호**: OBV가 먼저 방향을 바꾸면 주목!

## 전략 사용 시 주의사항

- 선물 시장의 **거래량은 주식과 다르게** 해석해야 합니다 (계약 단위).
- **롤오버 기간**에는 거래량이 왜곡될 수 있습니다.
- OBV의 **절대값보다 방향(추세)**에 집중하세요.
- 다이버전스는 **확인 신호 후 진입**이 안전합니다.
